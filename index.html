<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Law Gear: ë¨¸ë‹ˆì‚¬ì´íŠ¸ ë¹Œë“œì—… ë¡œë“œë§µ (Pacemaker Edition)</title>
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234F46E5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z'/><path d='m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z'/><path d='M7 21h10'/><path d='M12 3v18'/><path d='M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2'/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #0f172a; }
        
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .card-hover { transition: all 0.2s ease-in-out; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Level Badge Animation */
        @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); } 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); } }
        .level-badge { animation: pulse-ring 2s infinite; }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-slate-50">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 px-4 lg:px-8 h-16 flex items-center justify-between card-shadow">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="switchView('dashboard')">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-md group-hover:bg-indigo-700 transition-colors">
                <i class="fa-solid fa-scale-balanced"></i>
            </div>
            <h1 class="text-xl font-bold text-slate-800 hidden md:block group-hover:text-indigo-700 transition-colors">Law Gear <span class="text-indigo-600">Pacemaker</span></h1>
        </div>
        <div class="flex items-center gap-2 md:gap-4">
            <!-- Global Progress (Desktop) -->
            <div class="hidden lg:flex items-center gap-2 text-sm font-medium text-slate-600 mr-4">
                <span>Total Exp:</span>
                <div class="w-32 h-2.5 bg-slate-200 rounded-full overflow-hidden">
                    <div id="globalProgressBar" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                <span id="globalProgressText" class="text-indigo-600 font-bold">0%</span>
            </div>

            <!-- Mobile/Desktop Nav -->
            <button onclick="switchView('dashboard')" class="nav-btn bg-indigo-50 text-indigo-700 px-3 py-2 rounded-lg font-bold text-sm hover:bg-indigo-100 transition-colors flex items-center gap-2" title="í™ˆ">
                <i class="fa-solid fa-house"></i> <span class="hidden sm:inline">í™ˆ</span>
            </button>
            <button onclick="switchView('roadmap')" class="nav-btn text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-2" title="ë¡œë“œë§µ">
                <i class="fa-solid fa-map"></i> <span class="hidden sm:inline">ë¡œë“œë§µ</span>
            </button>
            <button onclick="switchView('library')" class="nav-btn text-slate-600 hover:text-indigo-600 px-3 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-2" title="ì „ì²´ ëª©ë¡">
                <i class="fa-solid fa-list"></i> <span class="hidden sm:inline">ë¼ì´ë¸ŒëŸ¬ë¦¬</span>
            </button>
            <button onclick="switchView('settings')" class="nav-btn text-slate-400 hover:text-slate-600 px-3 py-2 transition-colors" title="ì„¤ì •/ìºì‹œì‚­ì œ">
                <i class="fa-solid fa-gear text-lg"></i>
            </button>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto w-full p-4 lg:p-8">

        <!-- VIEW 1: DASHBOARD (GAMIFIED) -->
        <div id="dashboard-view" class="space-y-8 animate-fade-in">
            
            <!-- Top Status Bar: Level & Money Power -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- 1. My Level Card -->
                <div class="bg-white rounded-2xl p-6 border border-slate-200 card-shadow flex items-center gap-6 relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-indigo-50 rounded-full blur-2xl -mr-6 -mt-6"></div>
                    <div class="relative z-10">
                        <div id="levelBadge" class="w-20 h-20 rounded-full bg-slate-100 flex items-center justify-center text-3xl shadow-inner border-4 border-slate-200 text-slate-400">
                            <i class="fa-solid fa-user"></i>
                        </div>
                    </div>
                    <div class="flex-1 z-10">
                        <p class="text-xs font-bold text-slate-400 uppercase mb-1">Current Rank</p>
                        <h2 id="currentLevelName" class="text-2xl font-bold text-slate-800">ì´ˆë³´ ë¸”ë¡œê±°</h2>
                        <div class="mt-2">
                            <div class="flex justify-between text-xs font-medium text-slate-500 mb-1">
                                <span>ë‹¤ìŒ ë ˆë²¨ê¹Œì§€</span>
                                <span id="expText">0 / 20 posts</span>
                            </div>
                            <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div id="levelProgressBar" class="h-full bg-indigo-500 rounded-full transition-all duration-700" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Revenue Power Card -->
                <div class="bg-white rounded-2xl p-6 border border-slate-200 card-shadow flex flex-col justify-center relative overflow-hidden">
                    <div class="absolute right-0 bottom-0 w-32 h-32 bg-emerald-50 rounded-full blur-3xl -mr-10 -mb-10"></div>
                    <div class="flex justify-between items-start z-10">
                        <div>
                            <p class="text-xs font-bold text-emerald-600 uppercase mb-1"><i class="fa-solid fa-bolt mr-1"></i>ë¨¸ë‹ˆ íŒŒì›Œ (Money Power)</p>
                            <h3 class="text-3xl font-bold text-slate-800" id="moneyPowerScore">0</h3>
                            <p class="text-xs text-slate-400 mt-1">ë°œí–‰ëœ ê¸€ì˜ ìˆ˜ìµ ê°€ì¹˜ ì´í•©</p>
                        </div>
                        <div class="text-right">
                            <span class="text-4xl text-emerald-200"><i class="fa-solid fa-chart-line"></i></span>
                        </div>
                    </div>
                </div>

                <!-- 3. Recent Activity Log -->
                <div class="bg-white rounded-2xl p-6 border border-slate-200 card-shadow flex flex-col relative overflow-hidden">
                    <h3 class="text-sm font-bold text-slate-500 uppercase mb-3"><i class="fa-solid fa-clock-rotate-left mr-1"></i>ìµœê·¼ ì •ë³µí•œ í€˜ìŠ¤íŠ¸</h3>
                    <div id="recentActivityList" class="flex-1 overflow-y-auto space-y-3 max-h-24 pr-2">
                        <p class="text-xs text-slate-400 italic">ì•„ì§ í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>

            <!-- Main Content Stats -->
            <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2 mt-4">
                <i class="fa-solid fa-layer-group text-indigo-500"></i> ë¶„ì•¼ë³„ ì ë ¹ í˜„í™©
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white p-5 rounded-xl border border-slate-200 hover:border-amber-400 transition-colors cursor-pointer group" onclick="filterLibrary('Traffic')">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded">TRAFFIC</span>
                        <i class="fa-solid fa-car text-amber-200 text-xl group-hover:text-amber-500 transition-colors"></i>
                    </div>
                    <div class="text-2xl font-bold text-slate-800" id="stat-traffic">0/40</div>
                    <div class="text-xs text-slate-400 mt-1">êµí†µ/ì‚¬ê³ </div>
                </div>
                <div class="bg-white p-5 rounded-xl border border-slate-200 hover:border-indigo-400 transition-colors cursor-pointer group" onclick="filterLibrary('Debt')">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded">DEBT</span>
                        <i class="fa-solid fa-file-invoice-dollar text-indigo-200 text-xl group-hover:text-indigo-500 transition-colors"></i>
                    </div>
                    <div class="text-2xl font-bold text-slate-800" id="stat-debt">0/40</div>
                    <div class="text-xs text-slate-400 mt-1">ë¹š/íšŒìƒ</div>
                </div>
                <div class="bg-white p-5 rounded-xl border border-slate-200 hover:border-emerald-400 transition-colors cursor-pointer group" onclick="filterLibrary('Housing')">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded">HOUSING</span>
                        <i class="fa-solid fa-house-chimney text-emerald-200 text-xl group-hover:text-emerald-500 transition-colors"></i>
                    </div>
                    <div class="text-2xl font-bold text-slate-800" id="stat-housing">0/40</div>
                    <div class="text-xs text-slate-400 mt-1">ì£¼ê±°/ìƒí™œ</div>
                </div>
                <div class="bg-white p-5 rounded-xl border border-slate-200 hover:border-rose-400 transition-colors cursor-pointer group" onclick="filterLibrary('Crime')">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold text-rose-600 bg-rose-50 px-2 py-1 rounded">CRIME</span>
                        <i class="fa-solid fa-user-shield text-rose-200 text-xl group-hover:text-rose-500 transition-colors"></i>
                    </div>
                    <div class="text-2xl font-bold text-slate-800" id="stat-crime">0/40</div>
                    <div class="text-xs text-slate-400 mt-1">ì‚¬ê¸°/ë²”ì£„</div>
                </div>
            </div>

            <!-- Analysis Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <h3 class="text-sm font-bold text-slate-800 mb-4 uppercase tracking-wider">Strategic Radar</h3>
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 card-shadow">
                    <h3 class="text-sm font-bold text-slate-800 mb-4 uppercase tracking-wider">Content Structure</h3>
                    <div id="sunburstChart" class="w-full h-[300px] md:h-[400px]"></div>
                </div>
            </div>
        </div>

        <!-- VIEW 2: ROADMAP -->
        <div id="roadmap-view" class="hidden space-y-8 animate-fade-in">
            <!-- Today's Mission Banner -->
            <div class="bg-gradient-to-r from-indigo-900 to-slate-800 rounded-2xl p-6 md:p-10 text-white shadow-xl flex flex-col md:flex-row items-center justify-between gap-8">
                <div class="flex-1 space-y-4">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-500/30 border border-indigo-400/30 text-indigo-200 text-xs font-bold uppercase tracking-wider">
                        <i class="fa-solid fa-flag-checkered"></i> Next Step
                    </div>
                    <h2 id="currentPhaseTitle" class="text-2xl md:text-3xl font-bold leading-tight">Lv.1 ê¸°ì´ˆ ê³µì‚¬</h2>
                    <p id="currentPhaseDesc" class="text-slate-300 text-sm md:text-base">ë¸”ë¡œê·¸ ì§€ìˆ˜ë¥¼ ìŒ“ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ê²€ìƒ‰ëŸ‰ì€ ì ì§€ë§Œ ì „í™˜ì´ ì‰¬ìš´ ìƒí™œ ë²•ë¥  í‚¤ì›Œë“œë¡œ 'ìœ íš¨íƒ€'ë¥¼ ë§Œë“œì„¸ìš”.</p>
                    <div class="flex gap-3 pt-2">
                        <div class="flex flex-col">
                            <span class="text-xs text-slate-400 uppercase">ë°œí–‰ëœ ê¸€</span>
                            <span class="text-2xl font-bold" id="totalPublishedCount">0</span>
                        </div>
                        <div class="w-px h-10 bg-slate-600 mx-2"></div>
                        <div class="flex flex-col">
                            <span class="text-xs text-slate-400 uppercase">ë‚¨ì€ í€˜ìŠ¤íŠ¸</span>
                            <span class="text-2xl font-bold text-amber-400" id="remainingCount">160</span>
                        </div>
                    </div>
                </div>
                
                <!-- Recommendation Card -->
                <div class="w-full md:w-80 bg-white/10 backdrop-blur-md border border-white/20 rounded-xl p-4 relative group hover:bg-white/15 transition-all cursor-pointer" onclick="openNextMission()">
                    <div class="flex justify-between items-start mb-2">
                        <span class="bg-amber-500 text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-sm">ğŸ”¥ ì¶”ì²œ ê¸€ê°</span>
                        <button onclick="sendToTelegram(event)" class="text-white hover:text-sky-400 transition-colors" title="í…”ë ˆê·¸ë¨ ì „ì†¡"><i class="fa-brands fa-telegram text-xl"></i></button>
                    </div>
                    <h3 id="nextMissionTitle" class="text-base font-bold text-white mb-1 leading-snug line-clamp-2">ë¡œë”©ì¤‘...</h3>
                    <p id="nextMissionHook" class="text-xs text-slate-300 line-clamp-1 italic">"ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤..."</p>
                    <div class="mt-3 pt-3 border-t border-white/10 flex justify-between items-center">
                        <span id="nextMissionLeg" class="text-xs font-medium text-indigo-200 bg-indigo-900/50 px-2 py-1 rounded">-</span>
                        <span class="text-xs text-amber-300 font-bold hover:underline">ì‘ì„±í•˜ëŸ¬ ê°€ê¸° &rarr;</span>
                    </div>
                </div>
            </div>

            <!-- Phases Grid -->
            <div class="grid grid-cols-1 gap-8 relative pb-20">
                <div class="hidden md:block absolute left-8 top-8 bottom-0 w-0.5 bg-gradient-to-b from-indigo-500 via-slate-300 to-slate-100"></div>
                <!-- Phase 1 -->
                <div class="roadmap-section relative pl-0 md:pl-20">
                    <div class="hidden md:flex absolute left-0 top-0 w-16 h-16 bg-white border-4 border-indigo-500 rounded-full items-center justify-center z-10 shadow-md">
                        <span class="text-xl font-bold text-indigo-700">1</span>
                    </div>
                    <div class="mb-4"><h3 class="text-xl font-bold text-slate-800">Lv.1 ê¸°ì´ˆ ë‹¤ì§€ê¸° <span class="text-sm font-normal text-slate-500 ml-2">ê²€ìƒ‰ ìœ ì…ì˜ ì”¨ì•— (ê¸€ 1~40)</span></h3></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="phase1-grid"></div>
                </div>
                <!-- Phase 2 -->
                <div class="roadmap-section relative pl-0 md:pl-20">
                    <div class="hidden md:flex absolute left-0 top-0 w-16 h-16 bg-white border-4 border-emerald-500 rounded-full items-center justify-center z-10 shadow-md">
                        <span class="text-xl font-bold text-emerald-700">2</span>
                    </div>
                    <div class="mb-4"><h3 class="text-xl font-bold text-slate-800">Lv.2 íŠ¸ë˜í”½ í­ë°œ <span class="text-sm font-normal text-slate-500 ml-2">ì´ìŠˆì„± í‚¤ì›Œë“œ ê³µëµ (ê¸€ 41~80)</span></h3></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="phase2-grid"></div>
                </div>
                <!-- Phase 3 -->
                <div class="roadmap-section relative pl-0 md:pl-20">
                    <div class="hidden md:flex absolute left-0 top-0 w-16 h-16 bg-white border-4 border-amber-500 rounded-full items-center justify-center z-10 shadow-md">
                        <span class="text-xl font-bold text-amber-700">3</span>
                    </div>
                    <div class="mb-4"><h3 class="text-xl font-bold text-slate-800">Lv.3 ì‹ ë¢° êµ¬ì¶• <span class="text-sm font-normal text-slate-500 ml-2">ì „ë¬¸ê°€ í¬ì§€ì…”ë‹ (ê¸€ 81~120)</span></h3></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="phase3-grid"></div>
                </div>
                <!-- Phase 4 -->
                <div class="roadmap-section relative pl-0 md:pl-20">
                    <div class="hidden md:flex absolute left-0 top-0 w-16 h-16 bg-white border-4 border-rose-500 rounded-full items-center justify-center z-10 shadow-md">
                        <span class="text-xl font-bold text-rose-700">4</span>
                    </div>
                    <div class="mb-4"><h3 class="text-xl font-bold text-slate-800">Lv.4 ìˆ˜ìµ ì‚¬ëƒ¥ <span class="text-sm font-normal text-slate-500 ml-2">CPA ê·¹ëŒ€í™” (ê¸€ 121~160)</span></h3></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="phase4-grid"></div>
                </div>
            </div>
        </div>

        <!-- VIEW 3: LIBRARY -->
        <div id="library-view" class="hidden space-y-6 animate-fade-in">
            <div class="bg-white p-4 rounded-xl border border-slate-200 card-shadow sticky top-20 z-40">
                <div class="flex flex-col md:flex-row gap-4 justify-between items-center">
                    <div class="flex items-center gap-2 overflow-x-auto no-scrollbar w-full md:w-auto">
                        <button class="filter-btn active bg-slate-800 text-white px-4 py-2 rounded-lg text-xs font-bold shrink-0" data-filter="all">ì „ì²´</button>
                        <button class="filter-btn bg-white border border-slate-200 text-slate-600 px-4 py-2 rounded-lg text-xs font-medium hover:bg-amber-50 shrink-0" data-filter="Traffic">êµí†µ</button>
                        <button class="filter-btn bg-white border border-slate-200 text-slate-600 px-4 py-2 rounded-lg text-xs font-medium hover:bg-indigo-50 shrink-0" data-filter="Debt">ë¹š</button>
                        <button class="filter-btn bg-white border border-slate-200 text-slate-600 px-4 py-2 rounded-lg text-xs font-medium hover:bg-emerald-50 shrink-0" data-filter="Housing">ì£¼ê±°</button>
                        <button class="filter-btn bg-white border border-slate-200 text-slate-600 px-4 py-2 rounded-lg text-xs font-medium hover:bg-rose-50 shrink-0" data-filter="Crime">ë²”ì£„</button>
                    </div>
                    <div class="relative w-full md:w-96">
                        <input type="text" id="searchInput" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰..." class="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-sm">
                        <i class="fa-solid fa-search absolute left-3 top-2.5 text-slate-400"></i>
                    </div>
                </div>
            </div>
            <div id="fullLibraryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pb-20">
                <!-- JS Populated -->
            </div>
        </div>

        <!-- VIEW 4: SETTINGS -->
        <div id="settings-view" class="hidden space-y-8 animate-fade-in max-w-2xl mx-auto mt-10">
            <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-200 text-center">
                <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa-solid fa-sliders text-2xl text-slate-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ì„¤ì • ë° ë°ì´í„° ê´€ë¦¬</h2>
                <p class="text-slate-500 mb-8 text-sm">ì‘ì—… ë‚´ì—­ ë°±ì—… ë˜ëŠ” ì´ˆê¸°í™”ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                
                <div class="grid grid-cols-1 gap-4">
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="exportData()" class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-200 hover:border-indigo-500 hover:bg-indigo-50 transition-all group">
                            <i class="fa-solid fa-download text-xl text-indigo-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="font-bold text-slate-700 text-sm">ë°±ì—… íŒŒì¼ ì €ì¥</span>
                        </button>
                        <button onclick="document.getElementById('importFile').click()" class="flex flex-col items-center justify-center p-4 rounded-xl border border-slate-200 hover:border-emerald-500 hover:bg-emerald-50 transition-all group">
                            <i class="fa-solid fa-upload text-xl text-emerald-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <span class="font-bold text-slate-700 text-sm">ë°±ì—… íŒŒì¼ ë³µì›</span>
                        </button>
                    </div>
                    
                    <!-- Clear Cache Button -->
                    <button onclick="resetData()" class="flex items-center justify-center p-4 rounded-xl border border-rose-200 bg-rose-50 hover:bg-rose-100 hover:border-rose-400 transition-all group mt-4">
                        <i class="fa-solid fa-trash-can text-lg text-rose-500 mr-2 group-hover:scale-110 transition-transform"></i>
                        <div class="text-left">
                            <span class="font-bold text-rose-700 block text-sm">ìºì‹œ ì‚­ì œ (ë°ì´í„° ì´ˆê¸°í™”)</span>
                            <span class="text-xs text-rose-500">ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ëª¨ë“  ë°œí–‰ ê¸°ë¡ì„ ì‚­ì œí•©ë‹ˆë‹¤.</span>
                        </div>
                    </button>
                </div>
                <input type="file" id="importFile" class="hidden" accept=".json" onchange="importData(this)">
            </div>
        </div>

    </main>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-slate-900/80 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300 flex flex-col" id="modalContent">
            <div class="relative bg-slate-800 p-6 shrink-0">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors text-xl"><i class="fa-solid fa-xmark"></i></button>
                <div class="flex items-center gap-2 mb-3">
                    <span id="m-leg" class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider bg-slate-700 text-white">CATEGORY</span>
                    <span id="m-phase" class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider bg-indigo-500 text-white">LV.1 BASE</span>
                </div>
                <h2 id="m-title" class="text-lg md:text-xl font-bold text-white leading-snug mb-4">Title Placeholder</h2>
                <div class="flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-600">
                    <div class="flex-1 min-w-0">
                        <div id="m-copy-text" class="text-amber-300 font-mono text-xs md:text-sm truncate">Title /// Keyword</div>
                    </div>
                    <button onclick="copyToClipboard('m-copy-text')" class="bg-amber-500 hover:bg-amber-400 text-indigo-900 text-xs font-bold px-3 py-2 rounded transition-colors whitespace-nowrap">ë³µì‚¬</button>
                </div>
            </div>
            <div class="p-6 space-y-6 overflow-y-auto">
                <div class="bg-slate-50 border border-slate-200 rounded-xl p-4 flex items-center justify-between">
                    <div><h4 class="text-sm font-bold text-slate-700">ë°œí–‰ ì™„ë£Œ ì²´í¬</h4><p class="text-xs text-slate-500">ì²´í¬ ì‹œ ê²½í—˜ì¹˜ì™€ ë¨¸ë‹ˆ íŒŒì›Œê°€ ìƒìŠ¹í•©ë‹ˆë‹¤.</p></div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="m-published-check" class="sr-only peer" onchange="togglePublishStatus()">
                        <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500"></div>
                    </label>
                </div>
                <!-- URL & Affiliate Input -->
                <div id="m-url-section" class="hidden space-y-3 animate-fade-in bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">ë°œí–‰ URL (ë‚´ ë¸”ë¡œê·¸)</label>
                        <input type="text" id="m-url-input" class="w-full bg-white border border-slate-300 rounded-lg p-2 text-sm outline-none" onchange="savePostDetails()">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-emerald-600 mb-1">ìˆ˜ìµ ì œíœ´ ë§í¬ (CPA/CPS)</label>
                        <input type="text" id="m-affiliate-input" class="w-full bg-white border border-emerald-300 rounded-lg p-2 text-sm outline-none" onchange="savePostDetails()">
                    </div>
                </div>

                <!-- Internal Link Library (per-post) -->
                <div class="bg-white border border-slate-200 rounded-xl p-4 space-y-3">
                    <div class="flex items-start justify-between gap-3">
                        <div>
                            <h4 class="text-slate-800 text-sm font-bold">ë‚´ë¶€ë§í¬(URL) ì €ì¥</h4>
                            <p class="text-xs text-slate-500">ë°œí–‰ URLì„ ì…ë ¥í•´ë‘ë©´, ë‚˜ì¤‘ì— ê¸€ ë¬¸ë§¥ì— ìì—°ìŠ¤ëŸ½ê²Œ ë„£ì„ ë‚´ë¶€ë§í¬ ë¬¸ì¥ì„ ìë™ìœ¼ë¡œ ë½‘ì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                        <button onclick="openLinkLibrary()" class="text-xs font-bold px-3 py-2 rounded-lg bg-slate-900 text-white hover:bg-slate-800 transition-colors whitespace-nowrap">
                            ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—´ê¸°
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold text-slate-500 mb-1">ë‚´ë¶€ë§í¬ URL</label>
                            <input type="text" id="m-il-url" class="w-full bg-white border border-slate-300 rounded-lg p-2 text-sm outline-none" placeholder="https://ë‚´ë¸”ë¡œê·¸ì£¼ì†Œ/..." />
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">ì•µì»¤(ì§§ì€ ì œëª©)</label>
                            <input type="text" id="m-il-anchor" class="w-full bg-white border border-slate-300 rounded-lg p-2 text-sm outline-none" placeholder="ì˜ˆ: ê°œì¸íšŒìƒ ì¤€ë¹„ì„œë¥˜" />
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="addInternalLinkToPost()" class="text-xs font-bold px-3 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 transition-colors">ì´ ê¸€ì— ì—°ê²°</button>
                        <button onclick="copyInternalLinkSnippets()" class="text-xs font-bold px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 transition-colors">ë¬¸ë§¥ìš© ë¬¸ì¥ 3ê°œ ë³µì‚¬</button>
                        <button onclick="copyInternalLinksHtml()" class="text-xs font-bold px-3 py-2 rounded-lg bg-slate-800 text-white hover:bg-slate-700 transition-colors">HTML ë‚´ë¶€ë§í¬ ë¸”ë¡ ë³µì‚¬</button>
                    </div>
                    <div id="m-internal-links" class="text-xs text-slate-600 space-y-2"></div>
                    <textarea id="m-il-snippets" class="hidden"></textarea>
                    <textarea id="m-il-html" class="hidden"></textarea>
                </div>

                <!-- Prompt Patch: CTA ìœ í˜• B + FAQ Q1~Q5 ê³ ì • -->
                <div class="bg-amber-50 p-4 rounded-xl border border-amber-200 space-y-3">
                    <div>
                        <h4 class="text-amber-900 text-sm font-bold">í”„ë¡¬í”„íŠ¸ íŒ¨ì¹˜(ë³µì‚¬í•´ì„œ GEMì— ë¶™ì—¬ë„£ê¸°)</h4>
                        <p class="text-xs text-amber-800">CTA ë²„íŠ¼ì´ ë°‹ë°‹í•´ì§€ëŠ” ë¬¸ì œì™€ FAQ í‘œê¸° í”ë“¤ë¦¼ì„ ë§‰ê¸° ìœ„í•œ â€œê°•ì œ ì‚½ì… ê·œì¹™â€ì…ë‹ˆë‹¤.</p>
                    </div>

                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <p class="text-xs font-bold text-amber-900">A) CTA ìœ í˜• B í…œí”Œë¦¿(êµ¬ì¡° ê³ ì •)</p>
                            <button onclick="copyValue('patchCtaTemplate')" class="text-xs font-bold px-3 py-2 rounded-lg bg-amber-600 text-white hover:bg-amber-500 transition-colors">ë³µì‚¬</button>
                        </div>
                        <textarea id="patchCtaTemplate" class="w-full bg-white border border-amber-200 rounded-lg p-3 text-xs font-mono leading-relaxed" rows="10" spellcheck="false">&lt;br&gt;
&lt;div style="margin: 40px 0; padding: 26px 18px; background: #fff7ed; border: 1px solid #fed7aa; border-radius: 18px; box-shadow: 0 10px 26px rgba(249,115,22,0.12); text-align: center;"&gt;
  &lt;p style="margin: 0 0 14px 0; font-size: 15px; color: #9a3412; font-weight: 800; letter-spacing: -0.2px;"&gt;
    âœ” ì§€ê¸ˆ ë°”ë¡œ ë¬´ë£Œ í¬ë ˆë”§ ë°›ê³  ì‹œì‘í•˜ì„¸ìš”
  &lt;/p&gt;

  &lt;a href="https://seedance2.ai/ko" target="_self"
     style="display:inline-flex; align-items:center; justify-content:center; gap:10px; width:100%; max-width:620px; box-sizing:border-box;
            background:linear-gradient(135deg,#FF6900,#F59E0B);
            color:#ffffff; padding:18px 20px; text-decoration:none; border-radius:999px;
            font-weight:900; font-size:18px; letter-spacing:-0.2px;
            box-shadow:0 14px 30px rgba(255,105,0,0.25);
            border:1px solid rgba(255,255,255,0.35);"&gt;
    &lt;span style="display:inline-flex; align-items:center; justify-content:center; width:34px; height:34px; border-radius:999px;
                 background:rgba(255,255,255,0.22);
                 border:1px solid rgba(255,255,255,0.35);
                 box-shadow:inset 0 0 0 1px rgba(255,255,255,0.15);
                 font-size:18px; line-height:1; flex-shrink:0;"&gt;
      ğŸš€
    &lt;/span&gt;
    &lt;span style="line-height:1.2; flex: 1;"&gt;Seedance 2.0 ë¬´ë£Œ ì²´í—˜í•˜ê¸°&lt;/span&gt;
    &lt;span style="display:inline-block; margin-left:6px; font-size:20px; line-height:1; opacity:0.95; flex-shrink:0;"&gt;â†’&lt;/span&gt;
  &lt;/a&gt;

  &lt;p style="margin: 10px 0 0 0; font-size: 13px; color: #9a3412; line-height: 1.7;"&gt;
    ì‹ ê·œ ê°€ì… ì‹œ 20 í¬ë ˆë”§ ì¦‰ì‹œ ì§€ê¸‰!
  &lt;/p&gt;
&lt;/div&gt;
&lt;br&gt;</textarea>
                    </div>

                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <p class="text-xs font-bold text-amber-900">B) FAQ Q1~Q5 í‘œê¸° ê°•ì œ + ìì²´ê²€ìˆ˜</p>
                            <button onclick="copyValue('patchFaqRule')" class="text-xs font-bold px-3 py-2 rounded-lg bg-amber-600 text-white hover:bg-amber-500 transition-colors">ë³µì‚¬</button>
                        </div>
                        <textarea id="patchFaqRule" class="w-full bg-white border border-amber-200 rounded-lg p-3 text-xs font-mono leading-relaxed" rows="9" spellcheck="false">[FAQ ì¶œë ¥ ê·œì¹™]
- FAQëŠ” ë°˜ë“œì‹œ 5ê°œ ê³ ì •
- í‘œê¸°ëŠ” ë¬´ì¡°ê±´ ì•„ë˜ í˜•ì‹ë§Œ í—ˆìš©:
  Q1. ...
  A1. ...
  Q2. ...
  A2. ...
  ...
  Q5. ...
  A5. ...

[FAQ ê¸ˆì§€ ê·œì¹™]
- "Q." "A." í‘œê¸° ê¸ˆì§€
- FAQ ì„¹ì…˜ ì•ˆì— &lt;h3&gt; ì‚¬ìš© ê¸ˆì§€

[ìì²´ê²€ìˆ˜(ì¶œë ¥ ì§ì „ í™•ì¸)]
- Q1~Q5 / A1~A5ê°€ ëª¨ë‘ ì¡´ì¬í•˜ëŠ”ê°€?
- ì´ 5ìŒ(10ì¤„)ì¸ê°€?
- "Q." "A." ë¬¸ìì—´ì´ 0ê°œì¸ê°€?</textarea>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><h4 class="text-xs font-bold text-slate-400 uppercase mb-1">Keyword</h4><p id="m-keyword" class="text-base font-bold text-slate-800">-</p></div>
                    <div><h4 class="text-xs font-bold text-slate-400 uppercase mb-1">Hook</h4><p id="m-hook" class="text-sm text-slate-600 italic border-l-2 border-amber-400 pl-3">-</p></div>
                </div>
                <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
                    <h4 class="text-indigo-700 text-sm font-bold mb-2">ê³µëµ í¬ì¸íŠ¸</h4><p id="m-body" class="text-sm text-slate-700 leading-relaxed whitespace-pre-line">-</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script>
        // Data & Logic
        const legs = [
            { id: 'Traffic', name: 'êµí†µ/ì‚¬ê³ ', color: 'amber', icon: 'fa-car' },
            { id: 'Debt', name: 'ë¹š/íšŒìƒ', color: 'indigo', icon: 'fa-file-invoice-dollar' },
            { id: 'Housing', name: 'ì£¼ê±°/ìƒí™œ', color: 'emerald', icon: 'fa-house-chimney' },
            { id: 'Crime', name: 'ì‚¬ê¸°/ë²”ì£„', color: 'rose', icon: 'fa-user-shield' }
        ];

        // Content Data (160 items)
        const contentTemplates = {
            Traffic: [
                { t: "ë¬¸ì½•í•˜ê³  ë„ë§ê°„ ì°¨ ì¡ëŠ”ë²• CCTV í™•ë³´ë¶€í„° ê²½ì°° ì‹ ê³ ê¹Œì§€", k: "ë¬¸ì½•ë³´ìƒ", p: 1 },
                { t: "ì£¼ì°¨ì¥ ëº‘ì†Œë‹ˆ ë¬¼í”¼ë„ì£¼ ë²Œê¸ˆ 20ë§Œì›? í•©ì˜ê¸ˆ íŒ", k: "ë¬¼í”¼ë„ì£¼ì‹ ê³ ", p: 1 },
                { t: "ì´ì¤‘ì£¼ì°¨ ì°¨ ë°€ë‹¤ê°€ ì¿µ! ê³¼ì‹¤ ë¹„ìœ¨ íŒë¡€ ì´ì •ë¦¬", k: "ì´ì¤‘ì£¼ì°¨ì‚¬ê³ ", p: 1 },
                { t: "ê³ ì†ë„ë¡œ 1ì°¨ë¡œ ì •ì†ì£¼í–‰ ì‹ ê³  ë°©ë²• (ìƒí’ˆê¶Œ ë°œì†¡)", k: "ì •ì†ì£¼í–‰ì‹ ê³ ", p: 2 },
                { t: "êµí†µì‚¬ê³  í•©ì˜ìš”ë ¹ í†µì›ì¹˜ë£Œë§Œìœ¼ë¡œ 200ë§Œì› ë°›ê¸°", k: "êµí†µì‚¬ê³ í•©ì˜ê¸ˆ", p: 4 },
                { t: "12ëŒ€ ì¤‘ê³¼ì‹¤ ì‹ í˜¸ìœ„ë°˜ ì‚¬ê³  í˜•ì‚¬í•©ì˜ê¸ˆ ì‹œì„¸", k: "12ëŒ€ì¤‘ê³¼ì‹¤", p: 3 },
                { t: "ìŒì£¼ìš´ì „ ë°©ì¡°ì£„ ë™ìŠ¹ì ì²˜ë²Œ ê¸°ì¤€ê³¼ ë²Œê¸ˆ", k: "ìŒì£¼ìš´ì „ë°©ì¡°", p: 2 },
                { t: "ë¯¼ì‹ì´ë²• ìŠ¤ì¿¨ì¡´ ì‚¬ê³  ë²Œê¸ˆ 500ë§Œì› í”¼í•˜ëŠ” ë²•", k: "ë¯¼ì‹ì´ë²•", p: 3 },
                { t: "ì „ë™ í‚¥ë³´ë“œ ì‚¬ê³  ë³´í—˜ ì²˜ë¦¬ ë° í•©ì˜ê¸ˆ ê°€ì´ë“œ", k: "í‚¥ë³´ë“œì‚¬ê³ ", p: 2 },
                { t: "ìì „ê±° ì‚¬ê³  ì¼ìƒìƒí™œë°°ìƒì±…ì„ë³´í—˜ ì²˜ë¦¬ ë…¸í•˜ìš°", k: "ìì „ê±°ì‚¬ê³ ", p: 1 }
            ],
            Debt: [
                { t: "ë¹š ë…ì´‰ ì „í™” ì•ˆ ë°›ëŠ” ë²•: ë¶ˆë²•ì¶”ì‹¬ ì‹ ê³ í•˜ê³  ë³´ìƒë°›ê¸°", k: "ë¶ˆë²•ì¶”ì‹¬ëŒ€ì‘", p: 1 },
                { t: "í†µì¥ì••ë¥˜ í•´ì œ ë°©ë²•: ìµœì €ìƒê³„ë¹„ 185ë§Œì› ì§€í‚¤ê¸°", k: "í†µì¥ì••ë¥˜", p: 1 },
                { t: "ê°œì¸íšŒìƒ ì‹ ì²­ìê²©: ì›”ê¸‰ 200ë§Œì›ë„ íƒ•ê° ê°€ëŠ¥í• ê¹Œ?", k: "ê°œì¸íšŒìƒìê²©", p: 3 },
                { t: "ì£¼ì‹ ì½”ì¸ ë¹š ê°œì¸íšŒìƒ ê°€ëŠ¥í• ê¹Œ? ìµœì‹  ë²•ì› íŒë¡€", k: "ì£¼ì‹ë¹šíƒ•ê°", p: 3 },
                { t: "ê°œì¸íšŒìƒ ê¸ˆì§€ëª…ë ¹ ê¸°ê° ì‚¬ìœ ì™€ ì¬ì‹ ì²­ ì „ëµ", k: "ê¸ˆì§€ëª…ë ¹", p: 3 },
                { t: "ì •ë¶€ì§€ì› ì„œë¯¼ëŒ€ì¶œ í–‡ì‚´ë¡  ìê²© ì¡°ê±´ ë° ë¶€ê²° ëŒ€ì•ˆ", k: "í–‡ì‚´ë¡ ", p: 4 },
                { t: "ì¹´ë“œê°’ ë¦¬ë³¼ë¹™ì˜ í•¨ì •: ì‹ ìš©ë“±ê¸‰ í•˜ë½ ë§‰ëŠ” ë²•", k: "ë¦¬ë³¼ë¹™í•´ì§€", p: 2 },
                { t: "í•¸ë“œí° ìš”ê¸ˆ ë¯¸ë‚© ì‹œ ë°œì‹ ì •ì§€ì™€ ì†Œì•¡ê²°ì œ ì°¨ë‹¨", k: "í†µì‹ ì—°ì²´", p: 1 },
                { t: "ìƒì†í¬ê¸° í•œì •ìŠ¹ì¸ ì°¨ì´ì  ë° ë¹„ìš© ë¹„êµ", k: "ìƒì†í¬ê¸°", p: 2 },
                { t: "ê°œì¸íŒŒì‚° ë©´ì±… í›„ ì‹ ìš©ì¹´ë“œ ë°œê¸‰ ì‹œê¸° ì •ë¦¬", k: "ë©´ì±…í›„ì‹ ìš©ì¹´ë“œ", p: 4 }
            ],
            Housing: [
                { t: "ì¸µê°„ì†ŒìŒ ë²•ì  ê¸°ì¤€ ë°ì‹œë²¨ê³¼ ë¶„ìŸì¡°ì •ìœ„ì›íšŒ ì‹ ì²­", k: "ì¸µê°„ì†ŒìŒê¸°ì¤€", p: 1 },
                { t: "ì•„ë«ì§‘ ëˆ„ìˆ˜ ì±…ì„: ì¼ìƒìƒí™œë°°ìƒì±…ì„ë³´í—˜ ì²˜ë¦¬ ê¿€íŒ", k: "ì¼ìƒìƒí™œë°°ìƒì±…ì„ë³´í—˜", p: 4 },
                { t: "ì „ì„¸ ë³´ì¦ê¸ˆ ë°˜í™˜ ë‚´ìš©ì¦ëª… ì‘ì„±ë²• (ì–‘ì‹ ì²¨ë¶€)", k: "ì „ì„¸ë³´ì¦ê¸ˆë°˜í™˜", p: 2 },
                { t: "ì „ì„¸ì‚¬ê¸° ì˜ˆë°©: ë“±ê¸°ë¶€ë“±ë³¸ ì„êµ¬ ê·¼ì €ë‹¹ ê³„ì‚°ë²•", k: "ì „ì„¸ì‚¬ê¸°ì˜ˆë°©", p: 1 },
                { t: "ì›”ì„¸ ì´ì‚¬ ë‚˜ê°ˆ ë•Œ ë„ë°° ì¥íŒ ì›ìƒë³µêµ¬ ê¸°ì¤€", k: "ì›ìƒë³µêµ¬ì˜ë¬´", p: 2 },
                { t: "ë¬µì‹œì  ê°±ì‹  í›„ í•´ì§€ í†µë³´: ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ëˆ„ê°€ ë‚¼ê¹Œ?", k: "ë¬µì‹œì ê°±ì‹ ", p: 3 },
                { t: "ì¥ê¸°ìˆ˜ì„ ì¶©ë‹¹ê¸ˆ ë°˜í™˜: ì´ì‚¬í•  ë•Œ ê¼­ ì±™ê²¨ì•¼ í•  ëˆ", k: "ì¥ê¸°ìˆ˜ì„ ì¶©ë‹¹ê¸ˆ", p: 1 },
                { t: "ì•„íŒŒíŠ¸ í™”ì¥ì‹¤ ë‹´ë°° ëƒ„ìƒˆ ì¸µê°„í¡ì—° ëŒ€ì²˜ë²•", k: "ì¸µê°„í¡ì—°", p: 1 },
                { t: "ë³´ì¼ëŸ¬ ê³ ì¥ ìˆ˜ë¦¬ë¹„ ì§‘ì£¼ì¸ vs ì„¸ì…ì ì±…ì„ ì†Œì¬", k: "ë³´ì¼ëŸ¬ìˆ˜ë¦¬", p: 2 },
                { t: "í–‰ë³µì£¼íƒ ì²­ë…„ ë²„íŒ€ëª© ì „ì„¸ìê¸ˆ ëŒ€ì¶œ ì¡°ê±´ ì •ë¦¬", k: "ë²„íŒ€ëª©ì „ì„¸", p: 4 }
            ],
            Crime: [
                { t: "ë³´ì´ìŠ¤í”¼ì‹± ì§€ê¸‰ì •ì§€ ê³¨ë“ íƒ€ì„ 30ë¶„ ëŒ€ì²˜ ë§¤ë‰´ì–¼", k: "ë³´ì´ìŠ¤í”¼ì‹±ì‹ ê³ ", p: 4 },
                { t: "ë‹¹ê·¼ë§ˆì¼“ ì‚¬ê¸° ì‹ ê³  ë°©ë²•: ë”ì¹˜íŠ¸ ì¡°íšŒë¶€í„° ê²½ì°°ì„œê¹Œì§€", k: "ì¤‘ê³ ê±°ë˜ì‚¬ê¸°", p: 1 },
                { t: "ìŠ¤ë¯¸ì‹± ë¬¸ì í´ë¦­í–ˆì„ ë•Œ í•´í‚¹ í™•ì¸ ë° ì´ˆê¸°í™” ë°©ë²•", k: "ìŠ¤ë¯¸ì‹±ë¬¸ì", p: 2 },
                { t: "í˜•ì‚¬ ë°°ìƒëª…ë ¹ì‹ ì²­ì„œ ì‘ì„±ë²•: ë¯¼ì‚¬ ì—†ì´ ëˆ ë°›ëŠ” ë²•", k: "ë°°ìƒëª…ë ¹ì‹ ì²­", p: 3 },
                { t: "í†µí™”ë…¹ìŒ ë²•ì  íš¨ë ¥: ìƒëŒ€ë°© ë™ì˜ ì—†ëŠ” ë…¹ì·¨ëŠ” ë¶ˆë²•?", k: "í†µí™”ë…¹ìŒí•©ë²•", p: 2 },
                { t: "ëª¸ìº í”¼ì‹± í˜‘ë°• ë¬´ëŒ€ì‘ì´ ë‹µ? ì˜ìƒ ìœ í¬ ë§‰ëŠ” ë²•", k: "ëª¸ìº í”¼ì‹±ëŒ€ì²˜", p: 4 },
                { t: "ë¡œë§¨ìŠ¤ ìŠ¤ìº  ì‚¬ê¸°: ì¸ìŠ¤íƒ€ ì™¸êµ­ì¸ ì˜ì‚¬ì˜ ì •ì²´", k: "ë¡œë§¨ìŠ¤ìŠ¤ìº ", p: 2 },
                { t: "ë¡¤ ëª¨ìš•ì£„ ê³ ì†Œ ì„±ë¦½ ìš”ê±´: íŠ¹ì •ì„± ê³µì—°ì„± ë¶„ì„", k: "ë¡¤ê³ ì†Œ", p: 1 },
                { t: "ìƒê°„ë…€ ì†Œì†¡ ì¦ê±° ìˆ˜ì§‘ê³¼ ìœ„ìë£Œ ì²­êµ¬ ê¸ˆì•¡", k: "ìƒê°„ë…€ì†Œì†¡", p: 4 },
                { t: "ëª…ì˜ˆí›¼ì†ì£„ ë²Œê¸ˆ ê¸°ì¤€: ì‚¬ì´ë²„ ëª¨ìš•ê³¼ ì‚¬ì‹¤ì ì‹œ", k: "ì‚¬ì´ë²„ëª…ì˜ˆí›¼ì†", p: 3 }
            ]
        };

        const generateDb = () => {
            let data = [];
            let id = 1;
            legs.forEach(leg => {
                const templates = contentTemplates[leg.id];
                templates.forEach((tmpl, idx) => {
                    data.push(createItem(id++, leg.id, tmpl.t, tmpl.k, tmpl.p));
                    data.push(createItem(id++, leg.id, `[ì‚¬ë¡€] ${tmpl.k} ì‹¤ì œ í•´ê²° í›„ê¸° ë° íŒë¡€ ë¶„ì„`, tmpl.k + "í›„ê¸°", Math.min(4, tmpl.p + 1)));
                    data.push(createItem(id++, leg.id, `${tmpl.k} ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ BEST 5 ì´ì •ë¦¬`, tmpl.k + "ì§ˆë¬¸", Math.max(1, tmpl.p - 1)));
                    data.push(createItem(id++, leg.id, `2026ë…„ ${tmpl.k} ë²• ê°œì • ì‚¬í•­ ë° ì£¼ì˜í•  ì `, tmpl.k + "ë²•ê°œì •", 3));
                });
            });
            return data;
        };

        const createItem = (id, legId, title, keyword, phase) => {
            return {
                id, leg: legId, title: `${title} /// ${keyword}`, keyword, phase,
                hook: "ì´ ê¸€ì„ ì½ì§€ ì•Šìœ¼ë©´ 100ë§Œ ì› ì†í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì „ë¬¸ê°€ì˜ ì¡°ì–¸ì„ í™•ì¸í•˜ì„¸ìš”.",
                body: "ë…ìì˜ ê³µí¬ì‹¬ì„ ìê·¹í•˜ê³  í•´ê²°ì±…ì„ ì œì‹œí•˜ì„¸ìš”. ë²•ì  ê·¼ê±°(ì œOì¡°)ë¥¼ ëª…ì‹œí•˜ì—¬ ì‹ ë¢°ë¥¼ ë†’ì´ì„¸ìš”.",
                seo: `${keyword}, ${keyword}ë¹„ìš©, ${keyword}ì ˆì°¨`,
                cpa: legId === 'Debt' ? 'ê°œì¸íšŒìƒ ë¬´ë£Œ ì¡°íšŒ' : 'ë¬´ë£Œ ë²•ë¥  ìƒë‹´',
                published: false, url: '', affiliateUrl: ''
            };
        };

        let db = generateDb();
        const STORAGE_KEY = 'lawgear_pacemaker_v1';

        function init() { loadData(); updateUI(); }
        
        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const savedData = JSON.parse(saved);
                savedData.forEach(s => {
                    const item = db.find(d => d.id === s.id);
                    if (item) { item.published = s.published; item.url = s.url; item.affiliateUrl = s.affiliateUrl; }
                });
            }
        }

        function saveData() {
            const dataToSave = db.filter(d => d.published).map(d => ({ id: d.id, published: d.published, url: d.url, affiliateUrl: d.affiliateUrl }));
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            updateUI();
        }

        function updateUI() {
            // Null check helper
            const setSafe = (id, val) => { const el = document.getElementById(id); if(el) el.innerText = val; };
            const styleSafe = (id, width) => { const el = document.getElementById(id); if(el) el.style.width = width; };

            const total = db.length;
            const done = db.filter(d => d.published).length;
            const pct = Math.round((done / total) * 100);
            
            // Global Nav
            styleSafe('globalProgressBar', `${pct}%`);
            setSafe('globalProgressText', `${pct}%`);

            // Dashboard View
            setSafe('totalPublishedCount', done);
            setSafe('remainingCount', total - done);

            legs.forEach(leg => {
                const legDone = db.filter(d => d.leg === leg.id && d.published).length;
                setSafe(`stat-${leg.id.toLowerCase()}`, `${legDone}/40`);
            });

            // Level & Money
            let levelName = "ì´ˆë³´ ë¸”ë¡œê±°", levelIcon = "fa-user", levelColor = "text-slate-400";
            if (done >= 5) { levelName = "ë¸Œë¡ ì¦ˆ (Bronze)"; levelIcon = "fa-medal"; levelColor = "text-amber-700"; }
            if (done >= 20) { levelName = "ì‹¤ë²„ (Silver)"; levelIcon = "fa-medal"; levelColor = "text-slate-400"; }
            if (done >= 50) { levelName = "ê³¨ë“œ (Gold)"; levelIcon = "fa-trophy"; levelColor = "text-yellow-500"; }
            if (done >= 100) { levelName = "ë‹¤ì´ì•„ëª¬ë“œ (Diamond)"; levelIcon = "fa-gem"; levelColor = "text-cyan-400"; }
            if (done >= 150) { levelName = "ë§ˆìŠ¤í„° (Master)"; levelIcon = "fa-crown"; levelColor = "text-indigo-600"; }

            setSafe('currentLevelName', levelName);
            const badge = document.getElementById('levelBadge');
            if(badge) badge.innerHTML = `<i class="fa-solid ${levelIcon} ${levelColor}"></i>`;
            setSafe('expText', `${done} / ${total} XP`);
            styleSafe('levelProgressBar', `${pct}%`);

            let moneyScore = 0;
            db.filter(d => d.published).forEach(d => {
                if(d.leg === 'Debt') moneyScore += 5;
                else if(d.leg === 'Traffic') moneyScore += 4;
                else if(d.leg === 'Housing') moneyScore += 3;
                else moneyScore += 2;
            });
            setSafe('moneyPowerScore', moneyScore);

            // Recent
            const recent = db.filter(d => d.published).slice(-5).reverse();
            const recentList = document.getElementById('recentActivityList');
            if (recentList) {
                if (recent.length > 0) {
                    recentList.innerHTML = recent.map(item => `
                        <div class="flex items-center gap-2 text-sm text-slate-600">
                            <i class="fa-solid fa-check-circle text-emerald-500"></i>
                            <span class="truncate font-medium">${item.title.split('///')[0]}</span>
                        </div>
                    `).join('');
                } else {
                    recentList.innerHTML = '<p class="text-xs text-slate-400 italic">ì•„ì§ í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            }

            // Next Mission
            const nextItem = db.sort((a, b) => a.phase - b.phase).find(d => !d.published);
            if (nextItem) {
                setSafe('nextMissionTitle', nextItem.title.split('///')[0]);
                setSafe('nextMissionHook', `"${nextItem.hook}"`);
                const nextLegEl = document.getElementById('nextMissionLeg');
                if(nextLegEl) nextLegEl.innerText = nextItem.leg.toUpperCase();
                
                const phaseNames = ["ê¸°ì´ˆ ê³µì‚¬", "íŠ¸ë˜í”½ í­ë°œ", "ì‹ ë¢° êµ¬ì¶•", "ìˆ˜ìµ ì‚¬ëƒ¥"];
                const phaseEl = document.getElementById('currentPhaseTitle');
                if(phaseEl) phaseEl.innerHTML = `Lv.${nextItem.phase} ${phaseNames[nextItem.phase-1]}`;
            } else {
                setSafe('currentPhaseTitle', "ğŸ‰ ë§ˆìŠ¤í„°(Master)");
                setSafe('nextMissionTitle', "ì™„ë£Œ!");
                setSafe('nextMissionHook', "ëª¨ë“  í€˜ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!");
            }

            renderRoadmap();
            renderFullLibrary();
            renderCharts();
        }

        // --- VIEWS ---
        function switchView(viewId) {
            ['dashboard', 'roadmap', 'library', 'settings'].forEach(v => {
                const el = document.getElementById(`${v}-view`);
                if(el) el.classList.add('hidden');
            });
            const target = document.getElementById(`${viewId}-view`);
            if(target) target.classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function renderRoadmap() {
            for(let i=1; i<=4; i++) {
                const container = document.getElementById(`phase${i}-grid`);
                if(!container) continue;
                container.innerHTML = '';
                
                db.filter(d => d.phase === i).forEach(item => {
                    const isDone = item.published;
                    const legColor = item.leg === 'Traffic' ? 'amber' : item.leg === 'Debt' ? 'indigo' : item.leg === 'Housing' ? 'emerald' : 'rose';
                    const el = document.createElement('div');
                    el.className = `bg-white p-4 rounded-xl border ${isDone ? 'border-slate-200 opacity-60' : 'border-slate-200'} card-shadow card-hover relative group cursor-pointer`;
                    if(!isDone) el.classList.add('border-l-4', `border-l-${legColor}-500`);
                    
                    el.onclick = () => openModal(item.id);
                    el.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-${legColor}-50 text-${legColor}-700 uppercase">${item.leg}</span>
                            <div class="flex items-center gap-1">
                                ${item.affiliateUrl ? '<span class="text-emerald-500 text-xs"><i class="fa-solid fa-dollar-sign"></i></span>' : ''}
                                ${isDone ? '<i class="fa-solid fa-circle-check text-emerald-500"></i>' : '<i class="fa-regular fa-circle text-slate-300"></i>'}
                            </div>
                        </div>
                        <h4 class="text-sm font-bold text-slate-800 leading-snug ${isDone ? 'line-through text-slate-400' : ''}">${item.title.split('///')[0]}</h4>
                    `;
                    container.appendChild(el);
                });
            }
        }

        function renderFullLibrary() {
            const container = document.getElementById('fullLibraryGrid');
            if(!container) return;
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
            
            container.innerHTML = '';
            
            const filtered = db.filter(d => {
                const matchSearch = d.title.toLowerCase().includes(search) || d.keyword.toLowerCase().includes(search);
                const matchFilter = filter === 'all' ? true : (filter === d.leg || (filter === 'published' && d.published) || (filter === 'unpublished' && !d.published));
                return matchSearch && matchFilter;
            });

            filtered.forEach(item => {
                const el = document.createElement('div');
                el.className = "bg-white p-3 rounded-lg border border-slate-200 shadow-sm text-sm hover:border-indigo-300 cursor-pointer flex flex-col justify-between h-32";
                el.onclick = () => openModal(item.id);
                el.innerHTML = `
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <span class="w-2 h-2 rounded-full ${item.published ? 'bg-emerald-500' : 'bg-slate-300'}"></span>
                            <span class="text-xs text-slate-400 font-bold uppercase">${item.leg}</span>
                            ${item.affiliateUrl ? '<span class="text-emerald-500 text-xs ml-auto"><i class="fa-solid fa-dollar-sign"></i></span>' : ''}
                        </div>
                        <p class="font-medium text-slate-800 line-clamp-2">${item.title.split('///')[0]}</p>
                    </div>
                    <div class="text-xs text-slate-500 bg-slate-50 px-2 py-1 rounded w-fit mt-2">Lv.${item.phase}</div>
                `;
                container.appendChild(el);
            });
        }

        function filterLibrary(filterType) {
            switchView('library');
            const btns = document.querySelectorAll('.filter-btn');
            btns.forEach(b => {
                if(b.dataset.filter === filterType) b.click();
            });
        }

        // --- CHARTS ---
        function renderCharts() {
            const ctx = document.getElementById('radarChart')?.getContext('2d');
            if(ctx) {
                if(window.myRadar) window.myRadar.destroy();
                window.myRadar = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['ìˆ˜ìµì„±', 'ì ‘ê·¼ì„±', 'ê¸´ê¸‰ì„±', 'í™•ì¥ì„±', 'ë‚œì´ë„'],
                        datasets: [
                            { label: 'Traffic', data: [4,5,4,5,2], borderColor: '#f59e0b', backgroundColor: 'rgba(245,158,11,0.2)' },
                            { label: 'Debt', data: [5,3,5,4,4], borderColor: '#4f46e5', backgroundColor: 'rgba(79,70,229,0.2)' },
                            { label: 'Housing', data: [3,5,3,4,2], borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.2)' },
                            { label: 'Crime', data: [2,4,5,3,3], borderColor: '#f43f5e', backgroundColor: 'rgba(244,63,94,0.2)' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }

            const sunburstEl = document.getElementById('sunburstChart');
            if(sunburstEl) {
                const data = [{
                    type: "sunburst",
                    labels: ["Law Gear", "Traffic", "Debt", "Housing", "Crime"],
                    parents: ["", "Law Gear", "Law Gear", "Law Gear", "Law Gear"],
                    values: [160, 40, 40, 40, 40],
                    outsidetextfont: {size: 14, color: "#377eb8"},
                    marker: {colors: ["#1e293b", "#f59e0b", "#4f46e5", "#10b981", "#f43f5e"]}
                }];
                Plotly.newPlot('sunburstChart', data, {margin: {l:0, r:0, b:0, t:0}}, {responsive: true});
            }
        }

        // --- UTILS & MODAL ---
        let currentModalId = null;
        function openModal(id) {
            currentModalId = id;
            const item = db.find(d => d.id === id);
            if(!item) return;
            
            const legColor = item.leg === 'Traffic' ? 'bg-amber-500' : item.leg === 'Debt' ? 'bg-indigo-500' : item.leg === 'Housing' ? 'bg-emerald-500' : 'bg-rose-500';
            const mLeg = document.getElementById('m-leg'); if(mLeg) { mLeg.className = `px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider text-white ${legColor}`; mLeg.innerText = item.leg; }
            const mPhase = document.getElementById('m-phase'); if(mPhase) mPhase.innerText = `LV.${item.phase}`;
            const mTitle = document.getElementById('m-title'); if(mTitle) mTitle.innerText = item.title.split('///')[0];
            const mCopy = document.getElementById('m-copy-text'); if(mCopy) mCopy.innerText = item.title;
            const mKey = document.getElementById('m-keyword'); if(mKey) mKey.innerText = item.keyword;
            const mHook = document.getElementById('m-hook'); if(mHook) mHook.innerText = `"${item.hook}"`;
            const mBody = document.getElementById('m-body'); if(mBody) mBody.innerText = item.body;

            const chk = document.getElementById('m-published-check');
            const urlSec = document.getElementById('m-url-section');
            if(chk) chk.checked = item.published;
            if(urlSec) {
                if(item.published) urlSec.classList.remove('hidden');
                else urlSec.classList.add('hidden');
            }
            
            const mUrl = document.getElementById('m-url-input'); if(mUrl) mUrl.value = item.url || '';
            const mAff = document.getElementById('m-affiliate-input'); if(mAff) mAff.value = item.affiliateUrl || '';

            renderInternalLinks();

            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            if(modal) modal.classList.remove('hidden');
            if(content) setTimeout(() => content.classList.remove('scale-95'), 10);
        }

        function closeModal() {
            const content = document.getElementById('modalContent');
            const modal = document.getElementById('modal');
            if(content) content.classList.add('scale-95');
            if(modal) setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function togglePublishStatus() {
            const chk = document.getElementById('m-published-check');
            const urlSec = document.getElementById('m-url-section');
            const item = db.find(d => d.id === currentModalId);
            
            if (chk && item) {
                if (chk.checked) {
                    if(urlSec) urlSec.classList.remove('hidden');
                    item.published = true;
                } else {
                    if(urlSec) urlSec.classList.add('hidden');
                    item.published = false;
                }
                saveData();
            }
        }

        function savePostDetails() {
            const item = db.find(d => d.id === currentModalId);
            if(item) {
                const u = document.getElementById('m-url-input');
                const a = document.getElementById('m-affiliate-input');
                if(u) item.url = u.value;
                if(a) item.affiliateUrl = a.value;
                saveData();
            }
        }

        function openNextMission() {
            const next = db.sort((a, b) => a.phase - b.phase).find(d => !d.published);
            if(next) openModal(next.id);
        }

        function sendToTelegram(event) {
            event.stopPropagation();
            const next = db.sort((a, b) => a.phase - b.phase).find(d => !d.published);
            if(!next) return alert("ì™„ë£Œ!");
            const msg = `[Law Gear ë¯¸ì…˜]\nğŸ”¥ Lv.${next.phase}\nì œëª©: ${next.title.split('///')[0]}\ní‚¤ì›Œë“œ: ${next.keyword}\nê³µëµ: ${next.body}`;
            window.open(`https://t.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(msg)}`, '_blank');
        }

        function copyToClipboard(id) {
            navigator.clipboard.writeText(document.getElementById(id).innerText).t
        function copyValue(id){
            const el = document.getElementById(id);
            if(!el) return;
            navigator.clipboard.writeText(el.value || el.innerText || '').then(() => alert('ë³µì‚¬ì™„ë£Œ'));
        }

        // --- INTERNAL LINK LIBRARY ---
        const LINK_STORE_KEY = 'lawgear_internal_links_v1';

        function getLinkLibrary(){
            try { return JSON.parse(localStorage.getItem(LINK_STORE_KEY) || '[]'); }
            catch(e){ return []; }
        }

        function saveLinkLibrary(list){
            localStorage.setItem(LINK_STORE_KEY, JSON.stringify(list || []));
        }

        function normalizeUrl(url){
            return (url || '').trim();
        }

        function normalizeAnchor(anchor){
            return (anchor || '').trim();
        }

        function ensureItem(){
            return db.find(d => d.id === currentModalId);
        }

        function addInternalLinkToPost(){
            const item = ensureItem();
            if(!item) return;

            const url = normalizeUrl(document.getElementById('m-il-url')?.value);
            const anchor = normalizeAnchor(document.getElementById('m-il-anchor')?.value);

            if(!url || !anchor){
                alert('URLê³¼ ì•µì»¤ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            // Save to global library
            const lib = getLinkLibrary();
            const existing = lib.find(x => x.url === url);
            const linkId = existing ? existing.id : (Date.now().toString(36) + Math.random().toString(36).slice(2,6));
            if(!existing){
                lib.unshift({ id: linkId, url, anchor, createdAt: Date.now() });
                saveLinkLibrary(lib);
            } else if(anchor && existing.anchor !== anchor){
                existing.anchor = anchor;
                saveLinkLibrary(lib);
            }

            // Attach to post
            item.internalLinks = Array.isArray(item.internalLinks) ? item.internalLinks : [];
            if(!item.internalLinks.includes(linkId)){
                item.internalLinks.unshift(linkId);
                saveDb();
            }

            renderInternalLinks();
            document.getElementById('m-il-url').value = '';
            document.getElementById('m-il-anchor').value = '';
        }

        function removeInternalLinkFromPost(linkId){
            const item = ensureItem();
            if(!item) return;
            item.internalLinks = (item.internalLinks || []).filter(x => x !== linkId);
            saveDb();
            renderInternalLinks();
        }

        function renderInternalLinks(){
            const wrap = document.getElementById('m-internal-links');
            if(!wrap) return;

            const item = ensureItem();
            const lib = getLinkLibrary();
            const ids = (item && Array.isArray(item.internalLinks)) ? item.internalLinks : [];

            if(!ids.length){
                wrap.innerHTML = '<div class="text-slate-500">ì•„ì§ ì—°ê²°ëœ ë‚´ë¶€ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤. URLê³¼ ì•µì»¤ë¥¼ ì…ë ¥í•˜ê³  â€œì´ ê¸€ì— ì—°ê²°â€ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>';
                return;
            }

            const rows = ids.map(id => {
                const l = lib.find(x => x.id === id);
                const url = l?.url || '(ì‚­ì œë¨)';
                const anchor = l?.anchor || '(ì•µì»¤ ì—†ìŒ)';
                return `
                    <div class="flex items-start justify-between gap-3 bg-slate-50 border border-slate-200 rounded-lg p-3">
                        <div class="min-w-0">
                            <div class="font-bold text-slate-800 truncate">${anchor}</div>
                            <div class="text-slate-500 truncate">${url}</div>
                        </div>
                        <button onclick="removeInternalLinkFromPost('${id}')" class="text-xs font-bold px-2 py-1 rounded bg-rose-600 text-white hover:bg-rose-500 transition-colors">ì‚­ì œ</button>
                    </div>
                `;
            }).join('');

            wrap.innerHTML = rows;
        }

        function buildSnippets(){
            const item = ensureItem();
            const lib = getLinkLibrary();
            const ids = (item && Array.isArray(item.internalLinks)) ? item.internalLinks : [];
            const links = ids.map(id => lib.find(x => x.id === id)).filter(Boolean);

            if(!links.length) return { snippets: '', html: '' };

            // 3ê°€ì§€ ë¬¸ë§¥ ë¬¸ì¥(ê° ë§í¬ë§ˆë‹¤ 1ê°œì”©, ìµœëŒ€ 3ê°œ)
            const picks = links.slice(0, 3);
            const snippets = picks.map((l, i) => {
                const n = i+1;
                return `${n}) ê´€ë ¨ ê¸€ë„ ê°™ì´ ë³´ë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤: ${l.anchor} (${l.url})`;
            }).join('\n');

            // HTML ë¸”ë¡(ë‚´ë¶€ë§í¬ ëª¨ìŒ)
            const htmlBlock = '<div style="margin: 26px 0; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px;">\n' +
                              '  <p style="margin:0 0 10px 0; font-weight:800; color:#0f172a;">ğŸ“Œ í•¨ê»˜ ë³´ë©´ ì¢‹ì€ ê¸€</p>\n' +
                              links.slice(0,5).map(l => `  <p style="margin:0 0 8px 0; line-height:1.7;"><a href="${l.url}" target="_self" style="color:#1e40af; text-decoration:none; font-weight:800;">${l.anchor}</a></p>`).join('\n') +
                              '\n</div>';

            return { snippets, html: htmlBlock };
        }

        function copyInternalLinkSnippets(){
            const out = buildSnippets();
            if(!out.snippets){ alert('ì—°ê²°ëœ ë‚´ë¶€ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
            navigator.clipboard.writeText(out.snippets).then(() => alert('ë³µì‚¬ì™„ë£Œ'));
        }

        function copyInternalLinksHtml(){
            const out = buildSnippets();
            if(!out.html){ alert('ì—°ê²°ëœ ë‚´ë¶€ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
            navigator.clipboard.writeText(out.html).then(() => alert('ë³µì‚¬ì™„ë£Œ'));
        }

        function openLinkLibrary(){
            const lib = getLinkLibrary();
            const top = lib.slice(0, 30).map(l => `â€¢ ${l.anchor} â€” ${l.url}`).join('\n') || '(ë¹„ì–´ìˆìŒ)';
            alert('ë‚´ë¶€ë§í¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ìµœê·¼ 30ê°œ)\n\n' + top);
        }
hen(() => alert('ë³µì‚¬ì™„ë£Œ'));
        }

        function resetData() {
            if(confirm('ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë³µêµ¬ ë¶ˆê°€)')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        function exportData() {
            const dataToSave = db.filter(d => d.published).map(d => ({ id: d.id, published: d.published, url: d.url, affiliateUrl: d.affiliateUrl }));
            const blob = new Blob([JSON.stringify(dataToSave)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lawgear_data.json`;
            a.click();
        }

        function importData(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = e => {
                const loaded = JSON.parse(e.target.result);
                loaded.forEach(s => {
                    const item = db.find(d => d.id === s.id);
                    if(item) { item.published = s.published; item.url = s.url; item.affiliateUrl = s.affiliateUrl; }
                });
                saveData();
                alert('ë³µì› ì™„ë£Œ');
            };
            reader.readAsText(file);
        }

        // Filters
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.classList.remove('bg-slate-800', 'text-white');
                    b.classList.add('bg-white', 'text-slate-600');
                    b.classList.remove('active');
                });
                e.target.classList.remove('bg-white', 'text-slate-600');
                e.target.classList.add('bg-slate-800', 'text-white', 'active');
                renderFullLibrary();
            });
        });
        const searchInput = document.getElementById('searchInput');
        if(searchInput) searchInput.addEventListener('input', renderFullLibrary);

        init();
    </script>
</body>
</html>
